<% content_for :title, @page_title %>

<div class="container mx-auto px-2 md:px-4 py-4 md:py-8">
  <%= turbo_frame_tag "rankings_container" do %>
    <div class="mb-4 md:mb-8">
      <h1 class="text-xl md:text-3xl font-bold text-gray-800 mb-3 md:mb-4"><%= @page_title %></h1>
    </div>

  <!-- Forecaster Rankings Table -->
  <div class="bg-white shadow-lg rounded-lg overflow-hidden">

    <% if @rankings.any? %>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-2 md:px-4 py-2 md:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16">
              Rank
            </th>
            <th class="px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Forecaster
            </th>
            <th class="px-3 md:px-6 py-2 md:py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32">
              Accuracy
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @rankings.each do |ranking| %>
            <% is_current_user = user_signed_in? && current_user.id == ranking[:user_id] %>
            <tr class="<%= is_current_user ? 'bg-amber-100 border-l-4 border-amber-400' : '' %>">
              <td class="px-2 md:px-4 py-2 md:py-4 whitespace-nowrap text-xs md:text-sm font-medium text-gray-900 w-16">
                <%= ranking[:rank] %>
              </td>
              <td class="px-3 md:px-6 py-2 md:py-4">
                <%= link_to forecaster_path(ranking[:user_id]), data: { turbo_frame: "_top" }, class: "text-xs md:text-sm font-medium text-gray-900 hover:text-yellow-500 break-words underline" do %>
                  <%= ranking[:username] %>
                <% end %>
              </td>
              <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap text-right text-xs md:text-sm font-medium text-gray-900 w-32">
                <%= (ranking[:total_score] * 100).round(2) %>%
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="px-6 py-8 text-center">
        <div class="text-gray-500">
          <h3 class="mt-2 text-sm font-medium text-gray-900">No rankings yet</h3>
          <p class="mt-1 text-sm text-gray-500">
            Rankings will appear once forecasts have been scored.
          </p>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
