<% content_for :meta_title, "FPL Forecaster Leaderboard - Who Can Beat the Bot? | Fantasy Forecast" %>
<% content_for :meta_description, "See who's beating the FPL forecasting bot. View the leaderboard of forecasters ranked by prediction accuracy and see how you compare." %>

<div class="container mx-auto px-2 md:px-4 py-4 md:py-8">
  <%= turbo_frame_tag "rankings_container" do %>
    <div class="mb-4 md:mb-8">
      <h1 class="text-xl md:text-3xl font-bold text-gray-800 mb-1 md:mb-2"><%= @page_title %></h1>
      <p class="text-sm text-gray-500">Showing forecasters active in the last 30 days, ranked by accuracy</p>
    </div>

  <!-- Forecaster Rankings Table -->
  <div class="bg-white shadow-lg rounded-lg overflow-hidden">

    <% if @rankings.any? %>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-2 md:px-4 py-2 md:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16">
              Rank
            </th>
            <th class="px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Forecaster
            </th>
            <th class="px-3 md:px-6 py-2 md:py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-24">
              Accuracy
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @rankings.each do |ranking| %>
            <% is_current_user = user_signed_in? && current_user.id == ranking[:user_id] %>
            <tr class="<%= is_current_user ? 'bg-amber-100 border-l-4 border-amber-400' : '' %>">
              <td class="px-2 md:px-4 py-2 md:py-4 whitespace-nowrap text-xs md:text-sm font-medium text-gray-800 w-16">
                <%= ranking[:rank] %>
              </td>
              <td class="px-3 md:px-6 py-2 md:py-4">
                <%= link_to ranking[:username], forecaster_path(ranking[:user_id]), data: { turbo_frame: "_top" }, class: "text-xs md:text-sm font-medium text-gray-800 hover:text-yellow-500 break-words underline" %>
                <%= user_badge(is_bot: ranking[:is_bot], beats_bot: ranking[:beats_bot]) %>
              </td>
              <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap text-right text-xs md:text-sm text-gray-600 w-24">
                <%= (ranking[:accuracy_score] * 100).round(1) %>%
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="px-6 py-8 text-center">
        <div class="text-gray-500">
          <h3 class="mt-2 text-sm font-medium text-gray-800">No rankings yet</h3>
          <p class="mt-1 text-sm text-gray-500">
            Rankings will appear once forecasts have been scored.
          </p>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
